## Дисклеймер 
Прочитав в интернете, для каких сервисов применяется докер-композ, я поняла, что часто он нужен в таких системах, где есть несколько серверов, например, бэк, фронт, базы данных и т.д. 

Очень удачно на курсе программирования мы делали сайт, который:
- парсит habr.ru
- собранные данные хранит в базе данных
- позволяет на отдельной страницы разметить их
- используя написанный с нуля наивный байесовский классификатор, создает рекомендательную систему
  
Сайт немного сухой в плане передвижения (надо самим вписывать путь в ссылке) и дизайна, но для данной лабораторной работы - вполне достаточно.

Единственная вещь, которуя я поменяла, была база данных. Изначально использовался SQLite и данные хранились в файле .bd, а я для большей практики и хардкора захотела создавать базу PostgreSQL, поэтому просто пришлось добавить +1 бибилиотеку в requirements.txt и изменить ссылку, по которой создается engine.

#### Здесь также хочу отметить, что я писала композ для dev, а не prod, то есть по-хорошему важно было иметь возможность вносить изменения без ненужных rebuildов 
## Хороший docker-compose.yml
1. Мы в целом не указываем version, потому что, начиная с какой-то версии, это делать не нужно и все и так работает
2. Ставим нормальные и понятные названия сервисов, в моем случае
```
services:
  postgres-db: #база данных
  ...
  database-init: #заполнение базы данных
  ...
  web-app: #бэк и фронт сайта 
  ...
```
### Основные изменения части postgres-db
- Берем образ полегче
- Встраиваем том, чтобы данные где-то хранились
- Важные данные конфингурации БД и пути пишем в переменные окружения и создаем файл .env, в котором они хранятся (удобнее для безопасности (если вдруг пойдет в прод) и для внесения изменений, то есть не надо переписывать docker-compose.yaml)
```
postgres-db:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: ${POSTGRES_DB}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      PYTHONPATH: ${PYTHONPATH}

    ports:
      - "5432:5432"
    volumes:
      - /postgres_data:/var/lib/postgresql/data 
```
### Основные изменения части database-init
- Определяю зависимость между серверами, чтобы все запускалось в правильном порядке
- Встраиваю тома: один для общих модулей, другой - для самой директории, чтобы при изменении кода не пересобирать все, а просто, собственно, добавить изменение и сделать рестарт
- То же самое про переменные окружения 
```
database-init:
    depends_on:
      - postgres-db

    build: .   

    command: python bd_filling.py
    working_dir: /app/database
    environment:
      DATABASE_URL: ${DATABASE_URL} 
      PYTHONPATH: ${PYTHONPATH}       

    volumes:
      - ./shared:/app/shared
      - ./database:/app/database
```
### Основные изменения части web-app
Тут все так же как и в части database-init, но:
- волюм сделан для нужной директории
- зависимости от серверов 2 штуки
- порты прописаны корректно (локальный порт перебрасывается на порт в контейнере)
```
depends_on:
      - postgres-db
      - database-init

    build: .   

    command: python habrnews.py         
    working_dir: /app/backend 
    environment:
      DATABASE_URL: ${DATABASE_URL} 
      PYTHONPATH: ${PYTHONPATH} 

    ports:
      - "8000:8080" 
    volumes:
      - ./shared:/app/shared  
      - ./backend:/app/backend
```

Ну и в конце, так как у нас Named volume (том в контейнере), мы его объявляем

```
volumes:
  postgres_data:
```
## Работа хорошего композа

Запустим все 
```
docker-compose up
```

Это некоторые логи из кода, которые говорят, что страницы парсятся (логи загрузки именно образа и сборки всей системы слишком большой)

<img width="910" height="352" alt="Снимок экрана 2025-10-17 211626" src="https://github.com/user-attachments/assets/c9c554df-84ea-4a23-9efc-d540b1a2daeb" />

После всех загрузок мы видим это

<img width="937" height="102" alt="Снимок экрана 2025-10-17 211740" src="https://github.com/user-attachments/assets/5d12e3ac-fb14-4ba1-bd37-939c53430e41" />

Зашли на сайт и потыкали что-то (по факту, разметили данные и дали Байесу на кушанье)

<img width="1759" height="959" alt="Снимок экрана 2025-10-17 203547" src="https://github.com/user-attachments/assets/a571a309-66ff-44f2-8b86-bf24cb7953dd" />
  
Зашли на рекомендации, которые подобрал Байес

<img width="1740" height="967" alt="Снимок экрана 2025-10-17 203642" src="https://github.com/user-attachments/assets/770b22f6-b7ec-40c4-96cd-7e658815739b" />

А это кусок логов, когда размечали данные

<img width="974" height="87" alt="Снимок экрана 2025-10-17 211752" src="https://github.com/user-attachments/assets/a56e009f-3887-4d16-a6ec-4cec7f62b02c" />

Теперь мне захотелось изменить часть кода, чтобы начальная страница была не с разметкой данных, а с рекомендациями. Изначально она стоит на разметке, т.к. без этого этапа не будет рекомендаций :/

<img width="566" height="104" alt="Снимок экрана 2025-10-17 212148" src="https://github.com/user-attachments/assets/70d2fabc-c286-413d-b17c-a834d9521680" />

Так что я просто меняю эту строку в коде без остановки композа, а потом, сохранив изменения, пишу
```
docker-compose restart web-app
```

<img width="692" height="48" alt="Снимок экрана 2025-10-17 212719" src="https://github.com/user-attachments/assets/2add3b2b-203b-4560-85bf-464385722d06" />

И вот я снова зашла на сайт, где меня приветствует уже страница рекомендаций 

<img width="1716" height="294" alt="Снимок экрана 2025-10-17 212727" src="https://github.com/user-attachments/assets/ad926f8f-47aa-482e-922b-7042eeabfb45" />

А тут еще я захотела посмотреть на табличку в БД

<img width="1898" height="497" alt="Снимок экрана 2025-10-17 204152" src="https://github.com/user-attachments/assets/5e25bcc4-1ac4-4163-83e2-64820b46e617" />
